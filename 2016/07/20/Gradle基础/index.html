<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Gradle基础 · EvilsoulM</title><meta name="description" content="Gradle是一个工具，同时它也是一个编程框架。前面也提到过，使用这个工具可以完成app的编译打包等工作。当然你也可以用它干其他的事情。"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://evilsoulm.com/atom.xml" title="EvilsoulM"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://www.weibo.com/1895866907" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/EvilsoulM" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Gradle基础</h1><div class="post-info">Jul 20, 2016</div><div class="post-content"><p><strong>Gradle</strong><br>Gradle是一个工具，同时它也是一个编程框架。前面也提到过，使用这个工具可以完成app的编译打包等工作。当然你也可以用它干其他的事情。</p>
<p><strong>相关</strong><br>Gradle的官网：<br><strong><a href="http://gradle.org/" target="_blank" rel="external">http://gradle.org/</a></strong><br><strong><a href="https://docs.gradle.org/current/dsl/" target="_blank" rel="external">https://docs.gradle.org/current/dsl/</a></strong><br><strong><a href="https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html" target="_blank" rel="external">https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html</a></strong></p>
<ul>
<li><strong>settings.gradle</strong><br>settings.gradle除了可以include外，还可以设置一些函数。这些函数会在gradle构建整个工程任务的时候执行，所以，可以在settings做一些初始化的工作。比如：我的settings.gradle的内容:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//定义一个名为initMinshengGradleEnvironment的函数。该函数内部完成一些初始化操作//比如创建特定的目录，设置特定的参数等</div><div class="line">def initMinshengGradleEnvironment()&#123;</div><div class="line"> println&quot;initialize Minsheng Gradle Environment .....&quot;</div><div class="line"> ......//干一些special的私活....</div><div class="line">  println&quot;initialize Minsheng Gradle Environment completes...&quot;</div><div class="line"> &#125;</div><div class="line"> //settings.gradle加载的时候，会执行initMinshengGradleEnvironment</div><div class="line"> initMinshengGradleEnvironment()</div><div class="line"> //include也是一个函数：</div><div class="line"> include &apos;CPosSystemSdk&apos; , &apos;CPosDeviceSdk&apos; ,   &apos;CPosSdkDemo&apos;,&apos;CPosDeviceServerApk&apos;,&apos;CPosSystemSdkWizarPosImpl&apos;</div></pre></td></tr></table></figure>
<p>##gradle命令介绍</p>
<ol>
<li>gradle projects查看工程信息</li>
<li>gradle tasks查看任务信息</li>
<li>gradle task-name执行任务<br>列出了好多任务，这时候就可以通过 gradle 任务名来执行某个任务。这和make xxx很像。比如：<br><strong>gradle clean</strong>是执行清理任务，和make clean类似。<br><strong>gradle properites</strong>用来查看所有属性信息。<br><strong>gradle tasks</strong>会列出每个任务的描述，通过描述，我们大概能知道这些任务是干什么的…..。然后gradle task-name执行它就好。<br>这里要强调一点：Task和Task之间往往是有关系的，<strong>这就是所谓的依赖关系。比如，assemble task就依赖其他task先执行，assemble才能完成最终的输出</strong>。</li>
</ol>
<p>##Gradle基本类型</p>
<p>gradle基于groovy, gradle提供的基本类型也都实现了script.并且提供了大量的方法和属性</p>
<p>Build script -&gt; Project (每个project的build.gradle也就是一个project)<br>Init script -&gt; Gradle<br>Settings script -&gt; Settings (对应setting.gradle)</p>
<ul>
<li><a href="https://docs.gradle.org/current/dsl/org.gradle.api.Project.html" target="_blank" rel="external">Project</a> 每个project的build.gradle都会转换成一个project</li>
<li><a href="https://docs.gradle.org/current/dsl/org.gradle.api.invocation.Gradle.html" target="_blank" rel="external">Gradle</a></li>
<li><a href="https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html" target="_blank" rel="external">Settings</a> 每一个settings.gradle都会转换成一个Settings对象</li>
</ul>
<p>##Gradle 生命周期<br>1.初始化创建Settings实例<br>2.解析settings.gradle 构造各个Project实例<br>3.解析每个Project对应的build.gradle，配置相应Project</p>
<p>即 setting.gradle -&gt; 各个build.gradle</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1070361-a1e3f7b0222a9b7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><img src="http://upload-images.jianshu.io/upload_images/1070361-5b8282c22b7ab389.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br>上面第一张图是settings.gradle的配置<br>第二张是执行assemble 打印出来的执行顺序，也就是说settings.gradle先执行<br>然后是root.gradle (也就是我们根目录下的gradle) 接下来就是按照settings.gradle配置顺序进行执行～</p>
<p>每个对象的方法就不再赘述，api中都有。</p>
<p>##实战<br>root gradle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// Top-level build file where you can add configuration options common to all sub-projects/modules.</div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.2.3&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;//对所有projects都起作用</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ext &#123;//定义所有project公用参数  使用rootProject.ext.XX就能拿到相应对象</div><div class="line">    compileSdk = 23</div><div class="line">    minSdk = 11</div><div class="line">    targetSdk = 23</div><div class="line">    support = &quot;23.1.1&quot;</div><div class="line">    buildTools = &quot;23.0.2&quot;</div><div class="line">    glide = &quot;3.6.0&quot;</div><div class="line">    okio = &quot;1.4.0&quot;</div><div class="line">    okhttp = &quot;2.4.0&quot;</div><div class="line">    fabric = &quot;2.4.0&quot;</div><div class="line">    leakcanary = &quot;1.3.1&quot;</div><div class="line">    logansquare = &quot;1.1.0&quot;</div><div class="line">    dagger = &quot;2.0.1&quot;</div><div class="line">    packageName = &quot;com.evilsoulm.keep_nice&quot;</div><div class="line">    butterknife = &quot;7.0.1&quot;</div><div class="line">    retrofit = &quot;2.0.0-beta2&quot;</div><div class="line">    greendao = &quot;2.0.0&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task clean(type: Delete) &#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>commonandroid.gradle android项目共用gradle 相当于基类 可以通过apply from 引入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">   android &#123;</div><div class="line">    compileSdkVersion rootProject.ext.compileSdk</div><div class="line">    buildToolsVersion rootProject.ext.buildTools</div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion rootProject.ext.minSdk</div><div class="line">        targetSdkVersion rootProject.ext.targetSdk</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    compileOptions &#123;</div><div class="line">        sourceCompatibility JavaVersion.VERSION_1_7</div><div class="line">        targetCompatibility JavaVersion.VERSION_1_7</div><div class="line">    &#125;</div><div class="line">    dexOptions &#123;</div><div class="line">        javaMaxHeapSize &quot;2048m&quot;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dexOptions &#123;</div><div class="line">        preDexLibraries project.hasProperty(&apos;debug&apos;)</div><div class="line">        incremental project.hasProperty(&apos;debug&apos;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    packagingOptions &#123;</div><div class="line">        exclude &apos;.readme&apos;</div><div class="line">        exclude &apos;LICENSE.txt&apos;</div><div class="line">        exclude &apos;META-INF/DEPENDENCIES&apos;</div><div class="line">        exclude &apos;META-INF/dependencies&apos;</div><div class="line">        exclude &apos;META-INF/DEPENDENCIES.txt&apos;</div><div class="line">        exclude &apos;META-INF/dependencies.txt&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>commonproject.gradle project项目共用gradle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">repositories &#123;</div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line">apply plugin: &apos;findbugs&apos;</div><div class="line">apply plugin: &apos;checkstyle&apos;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;com.android.application&apos;</div><div class="line">apply plugin: &apos;com.neenbedankt.android-apt&apos;</div><div class="line">apply from: rootProject.file(&apos;basegradle/commonProject.gradle&apos;)//引入commonProject</div><div class="line">apply from: rootProject.file(&apos;basegradle/commonAndroid.gradle&apos;)//引入commonAndroid</div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.neenbedankt.gradle.plugins:android-apt:1.8&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId rootProject.ext.packageName</div><div class="line">        versionCode 1</div><div class="line">        versionName &quot;1.0&quot;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            minifyEnabled false</div><div class="line">            debuggable true</div><div class="line">            jniDebuggable true</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        release &#123;</div><div class="line">            minifyEnabled true</div><div class="line">            shrinkResources false</div><div class="line"></div><div class="line">            debuggable false</div><div class="line">            jniDebuggable false</div><div class="line">            zipAlignEnabled true</div><div class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    configurations &#123;</div><div class="line">        all*.exclude group: &apos;com.google.android&apos;, module: &apos;android&apos;</div><div class="line">        all*.exclude group: &apos;com.google.android&apos;, module: &apos;support-v4&apos;</div><div class="line">        all*.exclude group: &apos;asm&apos;, module: &apos;asm&apos;</div><div class="line">        all*.exclude group: &apos;com.google.code.gson&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    productFlavors &#123;//很棒的一个参数可以在底下更改包名，资源等。。</div><div class="line">        normal &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        ddebug &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile project(&apos;:common&apos;)</div><div class="line">    compile project(&apos;:model&apos;)</div><div class="line">    compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</div><div class="line">    compile &apos;com.android.support:appcompat-v7:&apos; + rootProject.ext.support</div><div class="line">    compile &apos;com.android.support:design:&apos; + rootProject.ext.support</div><div class="line">    compile &apos;com.squareup.okio:okio:&apos; + rootProject.ext.okio</div><div class="line">    compile(&apos;com.squareup.okhttp:okhttp:&apos; + rootProject.ext.okhttp) &#123;</div><div class="line">        exclude group: &apos;com.squareup.okio&apos;, module: &apos;okio&apos;</div><div class="line">    &#125;</div><div class="line">    //图片加载</div><div class="line">    compile &apos;com.github.bumptech.glide:glide:&apos; + rootProject.ext.glide</div><div class="line">    //leakcanary</div><div class="line">    debugCompile &apos;com.squareup.leakcanary:leakcanary-android:&apos; + rootProject.ext.leakcanary</div><div class="line">    releaseCompile &apos;com.squareup.leakcanary:leakcanary-android-no-op:&apos; + rootProject.ext.leakcanary</div><div class="line">    //logansquare</div><div class="line">    apt &apos;com.bluelinelabs:logansquare-compiler:&apos; + rootProject.ext.logansquare</div><div class="line">    compile &apos;com.bluelinelabs:logansquare:&apos; + rootProject.ext.logansquare</div><div class="line">    //dagger2 注入</div><div class="line">    apt &apos;com.google.dagger:dagger-compiler:&apos; + rootProject.ext.dagger</div><div class="line">    compile &apos;com.google.dagger:dagger:&apos; + rootProject.ext.dagger</div><div class="line">    //UI注入</div><div class="line">    compile &apos;com.jakewharton:butterknife:&apos; + rootProject.ext.butterknife</div><div class="line">    //rxjava</div><div class="line">    compile &apos;io.reactivex:rxjava:1.0.10&apos;</div><div class="line">    compile &apos;io.reactivex:rxandroid:0.24.0&apos;</div><div class="line">    //网络框架</div><div class="line">    compile &apos;com.squareup.retrofit:retrofit:&apos; + rootProject.ext.retrofit</div><div class="line">    compile &apos;com.squareup.retrofit:converter-gson:&apos; + rootProject.ext.retrofit</div><div class="line">    compile &apos;com.squareup.retrofit:adapter-rxjava:&apos; + rootProject.ext.retrofit</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##写法2<br>另一种写法就是只有一个root.build 通过configure进行每个module的配置 ,每个module下的build.gradle就可以删除了～统一在root.build下进行管理<br>eg.只写了一个module</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.2.3&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ext &#123;</div><div class="line">    compileSdk = 23</div><div class="line">    minSdk = 11</div><div class="line">    targetSdk = 23</div><div class="line">    support = &quot;23.1.1&quot;</div><div class="line">    buildTools = &quot;23.0.2&quot;</div><div class="line">    glide = &quot;3.6.0&quot;</div><div class="line">    okio = &quot;1.4.0&quot;</div><div class="line">    okhttp = &quot;2.4.0&quot;</div><div class="line">    fabric = &quot;2.4.0&quot;</div><div class="line">    leakcanary = &quot;1.3.1&quot;</div><div class="line">    logansquare = &quot;1.1.0&quot;</div><div class="line">    dagger = &quot;2.0.1&quot;</div><div class="line">    packageName = &quot;com.evilsoulm.keep_nice&quot;</div><div class="line">    butterknife = &quot;7.0.1&quot;</div><div class="line">    retrofit = &quot;2.0.0-beta2&quot;</div><div class="line">    greendao = &quot;2.0.0&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">configure(project(&apos;:app&apos;).subprojects) &#123;//相当于放在app下的build.gradle</div><div class="line">    apply plugin: &apos;com.android.application&apos;</div><div class="line">    apply plugin: &apos;com.neenbedankt.android-apt&apos;</div><div class="line">    apply from: rootProject.file(&apos;basegradle/commonProject.gradle&apos;)</div><div class="line">    apply from: rootProject.file(&apos;basegradle/commonAndroid.gradle&apos;)</div><div class="line"></div><div class="line">    buildscript &#123;</div><div class="line">        repositories &#123;</div><div class="line">            mavenCentral()</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        dependencies &#123;</div><div class="line">            classpath &apos;com.neenbedankt.gradle.plugins:android-apt:1.8&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    android &#123;</div><div class="line">        defaultConfig &#123;</div><div class="line">            applicationId rootProject.ext.packageName</div><div class="line">            versionCode 1</div><div class="line">            versionName &quot;1.0&quot;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        buildTypes &#123;</div><div class="line">            debug &#123;</div><div class="line">                minifyEnabled false</div><div class="line">                debuggable true</div><div class="line">                jniDebuggable true</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            release &#123;</div><div class="line">                minifyEnabled true</div><div class="line">                shrinkResources false</div><div class="line"></div><div class="line">                debuggable false</div><div class="line">                jniDebuggable false</div><div class="line">                zipAlignEnabled true</div><div class="line">                proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        configurations &#123;</div><div class="line">            all*.exclude group: &apos;com.google.android&apos;, module: &apos;android&apos;</div><div class="line">            all*.exclude group: &apos;com.google.android&apos;, module: &apos;support-v4&apos;</div><div class="line">            all*.exclude group: &apos;asm&apos;, module: &apos;asm&apos;</div><div class="line">            all*.exclude group: &apos;com.google.code.gson&apos;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        productFlavors &#123;</div><div class="line">            normal &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            ddebug &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dependencies &#123;</div><div class="line">        compile project(&apos;:common&apos;)</div><div class="line">        compile project(&apos;:model&apos;)</div><div class="line">        compile fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</div><div class="line">        compile &apos;com.android.support:appcompat-v7:&apos; + rootProject.ext.support</div><div class="line">        compile &apos;com.android.support:design:&apos; + rootProject.ext.support</div><div class="line">        compile &apos;com.squareup.okio:okio:&apos; + rootProject.ext.okio</div><div class="line">        compile(&apos;com.squareup.okhttp:okhttp:&apos; + rootProject.ext.okhttp) &#123;</div><div class="line">            exclude group: &apos;com.squareup.okio&apos;, module: &apos;okio&apos;</div><div class="line">        &#125;</div><div class="line">        //图片加载</div><div class="line">        compile &apos;com.github.bumptech.glide:glide:&apos; + rootProject.ext.glide</div><div class="line">        //leakcanary</div><div class="line">        debugCompile &apos;com.squareup.leakcanary:leakcanary-android:&apos; + rootProject.ext.leakcanary</div><div class="line">        releaseCompile &apos;com.squareup.leakcanary:leakcanary-android-no-op:&apos; + rootProject.ext.leakcanary</div><div class="line">        //logansquare</div><div class="line">        apt &apos;com.bluelinelabs:logansquare-compiler:&apos; + rootProject.ext.logansquare</div><div class="line">        compile &apos;com.bluelinelabs:logansquare:&apos; + rootProject.ext.logansquare</div><div class="line">        //dagger2 注入</div><div class="line">        apt &apos;com.google.dagger:dagger-compiler:&apos; + rootProject.ext.dagger</div><div class="line">        compile &apos;com.google.dagger:dagger:&apos; + rootProject.ext.dagger</div><div class="line">        //UI注入</div><div class="line">        compile &apos;com.jakewharton:butterknife:&apos; + rootProject.ext.butterknife</div><div class="line">        //rxjava</div><div class="line">        compile &apos;io.reactivex:rxjava:1.0.10&apos;</div><div class="line">        compile &apos;io.reactivex:rxandroid:0.24.0&apos;</div><div class="line">        //网络框架</div><div class="line">        compile &apos;com.squareup.retrofit:retrofit:&apos; + rootProject.ext.retrofit</div><div class="line">        compile &apos;com.squareup.retrofit:converter-gson:&apos; + rootProject.ext.retrofit</div><div class="line">        compile &apos;com.squareup.retrofit:adapter-rxjava:&apos; + rootProject.ext.retrofit</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##属性<br>如果是单个脚本，则不需要考虑属性的跨脚本传播，但是Gradle往往包含不止一个build.gradle文件，比如我设置的utils.gradle，settings.gradle。如何在多个脚本中设置属性呢？<br>Gradle提供了一种名为<strong>extra property</strong>的方法。<strong>extra property</strong>是额外属性的意思，在第一次定义该属性的时候需要通过ext前缀来标示它是一个额外的属性。定义好之后，后面的存取就不需要ext前缀了。ext属性支持Project和Gradle对象。即Project和Gradle对象都可以设置ext属性</p>
<p>在上面的例子中其实我们已经用到了ext来定义一些常亮，eg:packageName,compileversion等<br>现在结合groovy相关知识,再重构下上面的gradle配置.</p>
<p>定义一个const.gradle用来管理我们的常亮和各个库所依赖的库.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">ext &#123;</div><div class="line">    android_const = [</div><div class="line">            <span class="string">compileSdk :</span> <span class="number">23</span>,</div><div class="line">            <span class="string">minSdk     :</span> <span class="number">11</span>,</div><div class="line">            <span class="string">targetSdk  :</span> <span class="number">23</span>,</div><div class="line">            <span class="string">support    :</span> <span class="string">"23.1.1"</span>,</div><div class="line">            <span class="string">buildTools :</span> <span class="string">"23.0.2"</span>,</div><div class="line"><span class="symbol">            packageName:</span> <span class="string">"com.evilsoulm.keep_nice"</span></div><div class="line">    ]</div><div class="line"></div><div class="line">    dep_const = [</div><div class="line">            <span class="string">glide      :</span> <span class="string">"3.6.0"</span>,</div><div class="line">            <span class="string">okio       :</span> <span class="string">"1.4.0"</span>,</div><div class="line">            <span class="string">okhttp     :</span> <span class="string">"2.4.0"</span>,</div><div class="line">            <span class="string">fabric     :</span> <span class="string">"2.4.0"</span>,</div><div class="line">            <span class="string">leakcanary :</span> <span class="string">"1.3.1"</span>,</div><div class="line"><span class="symbol">            logansquare:</span> <span class="string">"1.1.0"</span>,</div><div class="line">            <span class="string">dagger     :</span> <span class="string">"2.0.1"</span>,</div><div class="line"><span class="symbol">            butterknife:</span> <span class="string">"7.0.1"</span>,</div><div class="line">            <span class="string">retrofit   :</span> <span class="string">"2.0.0-beta2"</span>,</div><div class="line">            <span class="string">greendao   :</span> <span class="string">"2.0.0"</span></div><div class="line">    ]</div><div class="line"></div><div class="line">    app_dep = [</div><div class="line">            <span class="string">"appcompat-v7"</span>      : <span class="string">'com.android.support:appcompat-v7:'</span> + android_const.support,</div><div class="line">            <span class="string">"design"</span>            : <span class="string">'com.android.support:design:'</span> + android_const.support,</div><div class="line">            <span class="string">"okio"</span>              : <span class="string">'com.squareup.okio:okio:'</span> + dep_const.okio,</div><div class="line">            <span class="string">"okhttp"</span>            : <span class="string">'com.squareup.okhttp:okhttp:'</span> + dep_const.okhttp,</div><div class="line">            <span class="string">"glide"</span>             : <span class="string">'com.github.bumptech.glide:glide:'</span> + dep_const.glide,</div><div class="line">            <span class="string">"debug_leakcanary"</span>  : <span class="string">'com.squareup.leakcanary:leakcanary-android:'</span> + dep_const.leakcanary,</div><div class="line">            <span class="string">"release_leakcanary"</span>: <span class="string">'com.squareup.leakcanary:leakcanary-android-no-op:'</span> + dep_const.leakcanary,</div><div class="line">            <span class="string">"glide"</span>             : <span class="string">'com.github.bumptech.glide:glide:'</span> + dep_const.glide,</div><div class="line">            <span class="string">"apt_logansquare"</span>   : <span class="string">'com.bluelinelabs:logansquare-compiler:'</span> + dep_const.logansquare,</div><div class="line">            <span class="string">"logansquare"</span>       : <span class="string">'com.bluelinelabs:logansquare:'</span> + dep_const.logansquare,</div><div class="line">            <span class="string">"apt_dagger"</span>        : <span class="string">'com.google.dagger:dagger-compiler:'</span> + dep_const.dagger,</div><div class="line">            <span class="string">"dagger"</span>            : <span class="string">'com.google.dagger:dagger:'</span> + dep_const.dagger,</div><div class="line">            <span class="string">"butterknife"</span>       : <span class="string">'com.jakewharton:butterknife:'</span> + dep_const.butterknife,</div><div class="line">            <span class="string">"rxjava"</span>            : <span class="string">'io.reactivex:rxjava:1.0.10'</span>,</div><div class="line">            <span class="string">"rxandroid"</span>         : <span class="string">'io.reactivex:rxandroid:0.24.0'</span>,</div><div class="line">            <span class="string">"retrofit"</span>          : <span class="string">'com.squareup.retrofit:retrofit:'</span> + dep_const.retrofit,</div><div class="line">            <span class="string">"converter-gson"</span>    : <span class="string">'com.squareup.retrofit:converter-gson:'</span> + dep_const.retrofit,</div><div class="line">            <span class="string">"adapter-rxjava"</span>    : <span class="string">'com.squareup.retrofit:adapter-rxjava:'</span> + dep_const.retrofit</div><div class="line">    ]</div><div class="line"></div><div class="line">    model_generator_dep = [</div><div class="line">            <span class="string">"greendao-generator"</span>: <span class="string">'de.greenrobot:greendao-generator:'</span> + dep_const.greendao</div><div class="line">    ]</div><div class="line"></div><div class="line">    model_dep = [</div><div class="line">            <span class="string">"greendao"</span>: <span class="string">'de.greenrobot:greendao:'</span> + dep_const.greendao,</div><div class="line">            <span class="string">"android"</span> : <span class="string">'com.google.android:android:4.1.1.4'</span></div><div class="line">    ]</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>根目录的build.gradle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// Top-level build file where you can add configuration options common to all sub-projects/modules.</div><div class="line">apply from: &quot;basegradle/const.gradle&quot; //引入const.gradle 有点继承的感觉 也就是现在rootProject也就拥有const.gradle里的方法和变量</div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath &apos;com.android.tools.build:gradle:1.2.3&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用<br>//老的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;java&apos;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile &apos;de.greenrobot:greendao:&apos; + rootProject.ext.greendao</div><div class="line">    compile(group: &apos;com.google.android&apos;, name: &apos;android&apos;, version: &apos;4.1.1.4&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>改造后 简单清楚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">apply plugin: &apos;java&apos;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    compile rootProject.ext.model_dep.greendao</div><div class="line">    compile rootProject.ext.model_dep.android</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>查看依赖树<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gradle dependencies</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">task helloShortCut &lt;&lt; &#123;</div><div class="line">    println &apos;short cut&apos;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//打印0道9</div><div class="line">task count &lt;&lt; &#123;</div><div class="line">    10.times &#123; print(&quot;$it &quot;) &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task intro(dependsOn: helloShortCut) &lt;&lt; &#123;</div><div class="line">    print &quot;i am gradle&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//动态task</div><div class="line">10.times &#123;</div><div class="line">    time -&gt;</div><div class="line">        task &quot;task$time&quot; &lt;&lt; &#123;</div><div class="line">            println &quot; i am task number $time&quot;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task8.dependsOn task1, task2, task3, task4</div><div class="line"></div><div class="line">task hello &lt;&lt; &#123;</div><div class="line">    println &apos;Hello Earth&apos;</div><div class="line">&#125;</div><div class="line">hello.doFirst &#123;</div><div class="line">    println &apos;Hello Venus&apos;</div><div class="line">&#125;</div><div class="line">hello.doLast &#123;</div><div class="line">    println &apos;Hello Mars&apos;</div><div class="line">&#125;</div><div class="line">hello &lt;&lt; &#123;</div><div class="line">    println &apos;Hello Jupiter&apos;</div><div class="line">&#125;</div><div class="line"></div><div class="line">task loadFile &lt;&lt; &#123;</div><div class="line">    def files = file(&apos;../antLoadfileResources&apos;).listFiles().sort();</div><div class="line">    files.each &#123;</div><div class="line">        File file -&gt;</div><div class="line">            if (file.isFile()) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">gradle.taskGraph.whenReady &#123;taskGraph -&gt;</div><div class="line">    if (taskGraph.hasTask(&quot;assembleSpeedCompilation&quot;)) &#123;</div><div class="line">        println &apos;_____________________________assembleSpeedCompilationDebug&apos;</div><div class="line">    &#125; else &#123;</div><div class="line">        println &apos;_____________________________--不包含&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//显示依赖包的存储路径task</div><div class="line"> showRemoteDependencies &lt;&lt; &#123;</div><div class="line">  configurations.compile.each &#123; println it</div><div class="line">  &#125;&#125;</div></pre></td></tr></table></figure>
<p>demo-&gt;<a href="https://github.com/EvilsoulM/Keep_Nice" target="_blank" rel="external">github</a></p>
<p>其他gradle:<br><a href="http://mp.weixin.qq.com/s?__biz=MzA3NTYzODYzMg==&amp;mid=401572523&amp;idx=1&amp;sn=19504d41b81f82a5388ae4f95072aea5&amp;scene=23&amp;srcid=12041X7V3OasnmafRevYn2jz#rd" target="_blank" rel="external">Android 开发必备知识：我和 Gradle 有个约会</a><br><a href="http://www.infoq.com/cn/articles/android-in-depth-gradle" target="_blank" rel="external">深入理解Android（一）：Gradle详解</a><br><a href="http://blog.csdn.net/yanbober/article/details/49314255" target="_blank" rel="external">Gradle脚本基础全攻略</a><br><a href="http://kevinpelgrims.com/blog/2015/06/11/speeding-up-your-gradle-builds/" target="_blank" rel="external">Speeding up Gradle builds</a><br><a href="http://blog.csdn.net/yanbober/article/details/49408489" target="_blank" rel="external">Android应用开发编译框架流程与IDE及Gradle概要 </a><br><a href="http://blog.csdn.net/innost/article/details/48228651" target="_blank" rel="external">深入理解Android之Gradle</a><br><a href="http://google.github.io/android-gradle-dsl/current/" target="_blank" rel="external">Android Plugin DSL Reference</a></p>
</div></article></div></section><footer><div class="paginator"></div><div data-thread-key="2016/07/20/Gradle基础/" data-title="Gradle基础" data-url="http://evilsoulm.com/2016/07/20/Gradle基础/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"seansun"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://evilsoulm.com">EvilsoulM</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>